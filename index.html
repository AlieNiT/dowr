<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <title>Ø¯ÙˆØ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 0.5rem;
        }

        .container {
            max-width: 800px;
            width: 100%;
            padding: 1rem;
            text-align: center;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }

        h2 {
            font-size: clamp(1.4rem, 4vw, 2rem);
            margin-bottom: 1.5rem;
            color: #fff;
            line-height: 1.3;
        }

        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.8rem;
            margin-bottom: 2rem;
        }

        .category {
            background: rgba(255,255,255,0.2);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .category:hover, .category:active {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .category.selected {
            border-color: #4CAF50;
            background: rgba(76,175,80,0.3);
        }

        .category h3 {
            font-size: clamp(1rem, 3vw, 1.2rem);
            margin-bottom: 0.3rem;
        }

        .category p {
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            opacity: 0.8;
            line-height: 1.2;
        }

        .slider-container {
            margin: 1.5rem 0;
        }

        .slider {
            width: 100%;
            max-width: 300px;
            height: 8px;
            border-radius: 5px;
            background: rgba(255,255,255,0.3);
            outline: none;
            margin: 1rem auto;
            display: block;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        /* Mobile-optimized circular arrangement */
        .circle-container {
            position: relative;
            width: min(350px, 90vw);
            height: min(350px, 90vw);
            margin: 1.5rem auto;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circle-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: rgba(255,255,255,0.7);
            z-index: 1;
        }

        .player-input {
            position: absolute;
            width: clamp(80px, 20vw, 120px);
            padding: 0.6rem;
            border: 2px solid;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            text-align: center;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }
        
        .player-input:focus {
            outline: none;
            background: rgba(255,255,255,0.3);
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        .player-input::placeholder {
            color: rgba(255,255,255,0.7);
            font-size: clamp(0.7rem, 2vw, 0.9rem);
        }

        /* Settings screen styles */
        .settings-container {
            display: grid;
            gap: 1.5rem;
            margin: 1.5rem 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .setting-item {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .setting-label {
            font-size: clamp(1.1rem, 3vw, 1.3rem);
            margin-bottom: 1rem;
            display: block;
        }

        .time-input {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 0.8rem;
            color: white;
            font-size: clamp(1rem, 3vw, 1.2rem);
            text-align: center;
            width: 100px;
            margin: 0 auto;
            display: block;
        }

        .time-input:focus {
            outline: none;
            background: rgba(255,255,255,0.3);
            border-color: #4CAF50;
        }

        .difficulty-buttons {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 0.8rem 1.5rem;
            color: white;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .difficulty-btn:hover, .difficulty-btn:active {
            background: rgba(255,255,255,0.3);
        }

        .difficulty-btn.selected {
            border-color: #4CAF50;
            background: rgba(76,175,80,0.3);
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: clamp(1rem, 3vw, 1.2rem);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-height: 50px;
            touch-action: manipulation;
        }

        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .timers {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .team-timer {
            flex: 1;
            min-width: 150px;
            margin: 0.3rem;
        }

        .team-name {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            margin-bottom: 0.5rem;
            font-weight: bold;
            line-height: 1.2;
        }

        .timer-bar {
            height: 15px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .timer-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.1s linear;
        }

        .game-area {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 2rem 1rem;
            margin: 1.5rem 0;
            backdrop-filter: blur(10px);
            border: 3px solid transparent;
            transition: border-color 0.3s ease;
        }

        .current-word {
            font-size: clamp(2rem, 8vw, 3rem);
            font-weight: bold;
            margin: 1.5rem 0;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            min-height: clamp(3rem, 10vw, 4rem);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
            word-break: break-word;
            hyphens: auto;
        }

        .word-difficulty {
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            color: rgba(255,255,255,0.8);
            margin-top: 0.5rem;
        }

        .current-player {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .word-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            font-size: clamp(1rem, 3vw, 1.3rem);
            padding: 1rem 2rem;
            flex: 1;
            max-width: 200px;
        }

        .skip-btn {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            flex: 1;
            max-width: 200px;
        }

        .skip-btn:disabled {
            background: linear-gradient(45deg, #ccc, #999);
            opacity: 0.5;
        }

        .eliminated {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .winner {
            font-size: clamp(2.5rem, 8vw, 4rem);
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            animation: pulse 2s infinite;
            line-height: 1.2;
            margin-bottom: 2rem;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .game-start {
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin: 1.5rem 0;
        }

        /* Enhanced mobile responsiveness */
        @media (max-width: 480px) {
            body {
                padding: 0.25rem;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .categories {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }
            
            .category {
                padding: 0.8rem 0.5rem;
                min-height: 70px;
            }
            
            .game-area {
                padding: 1.5rem 0.8rem;
                margin: 1rem 0;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .word-btn, .skip-btn {
                width: 100%;
                max-width: 250px;
                margin: 0.3rem 0;
            }
            
            .timers {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .team-timer {
                min-width: unset;
                margin: 0;
            }
            
            .setting-item {
                padding: 1rem;
            }
            
            .difficulty-buttons {
                flex-direction: column;
                align-items: center;
                gap: 0.6rem;
            }
            
            .difficulty-btn {
                width: 100%;
                max-width: 200px;
            }
        }

        @media (max-width: 320px) {
            .categories {
                grid-template-columns: 1fr;
            }
            
            .circle-container {
                width: 280px;
                height: 280px;
            }
            
            .player-input {
                width: 70px;
                font-size: 0.7rem;
                padding: 0.4rem;
            }
        }

        /* Enhanced touch targets for better mobile interaction */
        @media (hover: none) and (pointer: coarse) {
            .category, .difficulty-btn, .btn, .player-input {
                min-height: 44px;
            }
            
            .category:active, .difficulty-btn:active, .btn:active {
                background: rgba(255,255,255,0.4);
                transform: scale(0.98);
            }
        }

        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 500px) {
            h1 {
                font-size: 1.8rem;
                margin-bottom: 1rem;
            }
            
            h2 {
                font-size: 1.4rem;
                margin-bottom: 1rem;
            }
            
            .categories {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .category {
                padding: 0.8rem 0.5rem;
                min-height: 60px;
            }
            
            .circle-container {
                width: 250px;
                height: 250px;
            }
            
            .game-area {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .current-word {
                font-size: 2rem;
                margin: 1rem 0;
                min-height: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ -->
        <div id="categoryScreen" class="screen active">
            <h1>ğŸ¯ Ø¨Ø§Ø²ÛŒ Ø­Ø¯Ø³ Ú©Ù„Ù…Ù‡</h1>
            <h2>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</h2>
            <div class="categories">
                <div class="category" data-category="Ø­ÛŒÙˆØ§Ù†">
                    <h3>ğŸ¾ Ø­ÛŒÙˆØ§Ù†Ø§Øª</h3>
                    <p>Ø³Ú¯ØŒ Ú¯Ø±Ø¨Ù‡ØŒ ÙÛŒÙ„ØŒ Ø²Ø±Ø§ÙÙ‡...</p>
                </div>
                <div class="category" data-category="Ù…ÛŒÙˆÙ‡">
                    <h3>ğŸ Ù…ÛŒÙˆÙ‡â€ŒÙ‡Ø§</h3>
                    <p>Ø³ÛŒØ¨ØŒ Ù…ÙˆØ²ØŒ Ù¾Ø±ØªÙ‚Ø§Ù„ØŒ Ø§Ù†Ø¨Ù‡...</p>
                </div>
                <div class="category" data-category="ØºØ°Ø§">
                    <h3>ğŸ² ØºØ°Ø§Ù‡Ø§</h3>
                    <p>Ù¾ÛŒØªØ²Ø§ØŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ØŒ Ø³ÙˆØ´ÛŒØŒ Ù¾Ø§Ø³ØªØ§...</p>
                </div>
                <div class="category" data-category="Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ">
                    <h3>ğŸ¥¤ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒâ€ŒÙ‡Ø§</h3>
                    <p>Ø¢Ø¨ØŒ Ù†ÙˆØ´Ø§Ø¨Ù‡ØŒ Ù‚Ù‡ÙˆÙ‡ØŒ Ú†Ø§ÛŒ...</p>
                </div>
                <div class="category" data-category="Ø¨Ø§Ø²ÛŒÚ¯Ø±">
                    <h3>ğŸ­ Ø¨Ø§Ø²ÛŒÚ¯Ø±Ø§Ù†</h3>
                    <p>Ø§ÛŒØ±Ø§Ù†ÛŒ Ùˆ Ø®Ø§Ø±Ø¬ÛŒ...</p>
                </div>
                <div class="category" data-category="Ø§Ø´ÛŒØ§">
                    <h3>ğŸ“¦ Ø§Ø´ÛŒØ§Ø¡</h3>
                    <p>ÙˆØ³Ø§ÛŒÙ„ Ø±ÙˆØ²Ù…Ø±Ù‡ Ùˆ Ú†ÛŒØ²Ù‡Ø§...</p>
                </div>
                <div class="category" data-category="Ø§Ù†Ø³Ø§Ù†">
                    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Ø§Ù†Ø³Ø§Ù†</h3>
                    <p>Ø§Ø¹Ø¶Ø§ÛŒ Ø¨Ø¯Ù†ØŒ Ø±ÙˆØ§Ø¨Ø·...</p>
                </div>
                <div class="category" data-category="Ø´Ù‡Ø±">
                    <h3>ğŸ™ï¸ Ø´Ù‡Ø±Ù‡Ø§</h3>
                    <p>Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†...</p>
                </div>
                <div class="category" data-category="Ú©Ø´ÙˆØ± Ùˆ Ø´Ù‡Ø± Ø®Ø§Ø±Ø¬ÛŒ">
                    <h3>ğŸŒ Ú©Ø´ÙˆØ±Ù‡Ø§</h3>
                    <p>Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù† Ùˆ Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ÛŒ...</p>
                </div>
                <div class="category" data-category="Ø¨Ø±Ù†Ø¯">
                    <h3>ğŸ·ï¸ Ø¨Ø±Ù†Ø¯Ù‡Ø§</h3>
                    <p>Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ù…Ø¹Ø±ÙˆÙ...</p>
                </div>
                <div class="category" data-category="Ø´ØºÙ„">
                    <h3>ğŸ‘¨â€âš•ï¸ Ù…Ø´Ø§ØºÙ„</h3>
                    <p>Ø´ØºÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù...</p>
                </div>
                <div class="category" data-category="ÙˆØ±Ø²Ø´">
                    <h3>âš½ ÙˆØ±Ø²Ø´â€ŒÙ‡Ø§</h3>
                    <p>ÙˆØ±Ø²Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù...</p>
                </div>
            </div>
            <button class="btn" id="nextToPlayers" disabled>Ø¨Ø¹Ø¯ÛŒ: ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</button>
        </div>

        <!-- ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† -->
        <div id="playerScreen" class="screen">
            <h1>ğŸ‘¥ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h1>
            <div class="slider-container">
                <h2>ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†: <span id="playerCount">4</span></h2>
                <input type="range" min="4" max="10" step="2" value="4" class="slider" id="playerSlider">
            </div>
            <div class="circle-container" id="circleContainer">
                <div class="circle-center">Ù…ÛŒØ² Ø¨Ø§Ø²ÛŒ</div>
                <!-- ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒØ±Ù‡â€ŒØ§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>
            <button class="btn" id="nextToSettings">Ø¨Ø¹Ø¯ÛŒ: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ</button>
        </div>

        <!-- ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ -->
        <div id="settingsScreen" class="screen">
            <h1>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ</h1>
            <div class="settings-container">
                <div class="setting-item">
                    <label class="setting-label">â±ï¸ Ø²Ù…Ø§Ù† Ù‡Ø± ØªÛŒÙ… (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
                    <input type="number" class="time-input" id="teamTime" value="4" min="1" max="10">
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">â­ï¸ Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ø¯ Ú©Ø±Ø¯Ù† (Ø«Ø§Ù†ÛŒÙ‡):</label>
                    <input type="number" class="time-input" id="skipTime" value="10" min="0" max="30">
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">ğŸ¯ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ:</label>
                    <div class="difficulty-buttons">
                        <div class="difficulty-btn selected" data-difficulty="1">Ø¢Ø³Ø§Ù† â­</div>
                        <div class="difficulty-btn" data-difficulty="2">Ù…ØªÙˆØ³Ø· â­â­</div>
                        <div class="difficulty-btn" data-difficulty="3">Ø³Ø®Øª â­â­â­</div>
                    </div>
                </div>
            </div>
            <button class="btn" id="startGame">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ!</button>
        </div>

        <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ -->
        <div id="gameScreen" class="screen">
            <div class="timers" id="timers">
                <!-- ØªØ§ÛŒÙ…Ø± ØªÛŒÙ…â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>

            <div class="game-area">
                <div class="current-player" id="currentPlayer">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯!</div>
                <div class="current-word" id="currentWord">ğŸ®</div>
                <div class="word-difficulty" id="wordDifficulty"></div>
                <div class="game-controls" id="gameControls" style="display: none;">
                    <button class="btn word-btn" id="correctWord">Ø­Ø¯Ø³ Ø²Ø¯ÛŒÙ… âœ“</button>
                    <button class="btn skip-btn" id="skipWord">Ø±Ø¯ Ú©Ø±Ø¯Ù† â¯</button>
                </div>
            </div>

            <button class="btn" id="startGameBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
        </div>

        <!-- ØµÙØ­Ù‡ Ø¨Ø±Ù†Ø¯Ù‡ -->
        <div id="winnerScreen" class="screen">
            <div class="winner" id="winnerText">ğŸ† ØªÛŒÙ… Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!</div>
            <button class="btn" id="playAgain">Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
        </div>
    </div>
    <script src="words.js"></script>
    <script>
        // Game state
        let selectedCategories = [];
        let players = [];
        let teams = [];
        let currentPlayerIndex = 0;
        let currentWord = '';
        let currentWordDifficulty = 1;
        let gameWords = [];
        let usedWords = [];
        let gameActive = false;
        let teamTimers = [];
        let timerIntervals = [];
        let skipButtonTimeout;
        let skipCountdownInterval = null;
        
        // Game settings
        let teamTimeLimit = 4 * 60 * 1000; // 4 minutes in milliseconds
        let skipWaitTime = 10; // 10 seconds
        let difficultyLevel = 1;
        
        // Team colors
        const teamColors = ['#D62226', '#4542B9', '#01AA31', '#F5C603', '#411271'];
        const teamColorNames = ['Ù‚Ø±Ù…Ø²', 'Ø¢Ø¨ÛŒ', 'Ø³Ø¨Ø²', 'Ø²Ø±Ø¯', 'Ø¨Ù†ÙØ´'];
        
        // Persistent game data
        let savedCategories = [];
        let savedPlayerNames = [];

        // DOM elements
        const screens = {
            category: document.getElementById('categoryScreen'),
            player: document.getElementById('playerScreen'),
            settings: document.getElementById('settingsScreen'),
            game: document.getElementById('gameScreen'),
            winner: document.getElementById('winnerScreen')
        };

        // Initialize game
        function init() {
            setupCategorySelection();
            setupPlayerSetup();
            setupGameSettings();
            setupGameControls();
        }

        function setupCategorySelection() {
            const categories = document.querySelectorAll('.category');
            const nextBtn = document.getElementById('nextToPlayers');

            categories.forEach(category => {
                category.addEventListener('click', () => {
                    const categoryName = category.dataset.category;
                    
                    if (selectedCategories.includes(categoryName)) {
                        selectedCategories = selectedCategories.filter(cat => cat !== categoryName);
                        category.classList.remove('selected');
                    } else {
                        selectedCategories.push(categoryName);
                        category.classList.add('selected');
                    }

                    nextBtn.disabled = selectedCategories.length === 0;
                });
            });

            nextBtn.addEventListener('click', () => {
                // Save selected categories
                savedCategories = [...selectedCategories];
                showScreen('player');
                generatePlayerInputs();
            });
        }

        function setupPlayerSetup() {
            const slider = document.getElementById('playerSlider');
            const playerCountSpan = document.getElementById('playerCount');
            const nextBtn = document.getElementById('nextToSettings');

            slider.addEventListener('input', (e) => {
                const count = parseInt(e.target.value);
                playerCountSpan.textContent = count;
                generatePlayerInputs();
            });

            nextBtn.addEventListener('click', () => {
                const inputs = document.querySelectorAll('.player-input');
                players = [];
                savedPlayerNames = []; // Save player names
                
                inputs.forEach((input, index) => {
                    const name = input.value.trim() || `Ø¨Ø§Ø²ÛŒÚ©Ù† ${index + 1}`;
                    savedPlayerNames.push(name); // Store for next game
                    players.push({
                        name: name,
                        id: index
                    });
                });

                showScreen('settings');
            });
        }

        function generatePlayerInputs() {
            const container = document.getElementById('circleContainer');
            const count = parseInt(document.getElementById('playerSlider').value);
            
            // Remove existing inputs but keep the center text
            const existingInputs = container.querySelectorAll('.player-input');
            existingInputs.forEach(input => input.remove());
            
            const containerRect = container.getBoundingClientRect();
            const radius = Math.min(containerRect.width, containerRect.height) * 0.35; // Responsive radius
            const centerX = containerRect.width / 2;
            const centerY = containerRect.height / 2;
            
            for (let i = 0; i < count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'player-input';
                
                // Calculate position on circle
                const angle = (i * 2 * Math.PI) / count - Math.PI / 2; // Start from top
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                // Position the input
                input.style.left = `${x}px`;
                input.style.top = `${y}px`;
                
                // Determine team assignment and color
                const numTeams = count / 2;
                let teamId, teamColor, teamColorName;
                
                if (i < numTeams) {
                    // First half of players
                    teamId = i;
                } else {
                    // Second half of players
                    teamId = i - numTeams;
                }
                
                teamColor = teamColors[teamId % teamColors.length];
                teamColorName = teamColorNames[teamId % teamColorNames.length];
                
                // Set border color and placeholder based on team
                input.style.borderColor = teamColor;
                input.placeholder = `${teamColorName}`;
                
                // Pre-fill with saved names if available
                if (savedPlayerNames[i]) {
                    input.value = savedPlayerNames[i];
                }
                
                container.appendChild(input);
            }
        }

        function setupGameSettings() {
            const teamTimeInput = document.getElementById('teamTime');
            const skipTimeInput = document.getElementById('skipTime');
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            const startBtn = document.getElementById('startGame');

            // Team time setting
            teamTimeInput.addEventListener('change', (e) => {
                teamTimeLimit = parseInt(e.target.value) * 60 * 1000; // Convert to milliseconds
            });

            // Skip time setting
            skipTimeInput.addEventListener('change', (e) => {
                skipWaitTime = parseInt(e.target.value);
            });

            // Difficulty selection
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    difficultyBtns.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    difficultyLevel = parseInt(btn.dataset.difficulty);
                });
            });

            startBtn.addEventListener('click', () => {
                setupTeams();
                setupGameWords();
                showScreen('game');
                initializeGame();
            });
        }

        function setupTeams() {
            teams = [];
            teamTimers = [];
            
            const numTeams = players.length / 2;
            
            // Create teams with the pairing pattern: p1 with p4, p2 with p5, p3 with p6, etc.
            for (let teamId = 0; teamId < numTeams; teamId++) {
                const player1Index = teamId;
                const player2Index = teamId + numTeams;
                
                const team = {
                    players: [players[player1Index], players[player2Index]],
                    timeLeft: teamTimeLimit,
                    eliminated: false,
                    id: teamId,
                    color: teamColors[teamId % teamColors.length],
                    colorName: teamColorNames[teamId % teamColorNames.length]
                };
                teams.push(team);
                teamTimers.push(teamTimeLimit);
            }

            generateTimerBars();
        }

        function generateTimerBars() {
            const container = document.getElementById('timers');
            container.innerHTML = '';

            teams.forEach((team, index) => {
                const playerNames = team.players.map(p => p.name).join(' Ùˆ ');
                const timerDiv = document.createElement('div');
                timerDiv.className = 'team-timer';
                timerDiv.innerHTML = `
                    <div class="team-name" id="teamName${index}" style="color: ${team.color};">
                        ØªÛŒÙ… ${index + 1} (${team.colorName}): ${playerNames}
                    </div>
                    <div class="timer-bar">
                        <div class="timer-fill" id="timerFill${index}" style="background: ${team.color};"></div>
                    </div>
                `;
                container.appendChild(timerDiv);
            });
        }

        function setupGameWords() {
            gameWords = [];
            selectedCategories.forEach(category => {
                // Find the category in wordCategories (using Persian names)
                const categoryData = wordCategories[category];
                if (categoryData) {
                    categoryData.forEach(([word, diff]) => {
                        // Only add words from selected difficulty level and below
                        if (diff <= difficultyLevel) {
                            gameWords.push({
                                word: word,
                                difficulty: diff,
                                category: category
                            });
                        }
                    });
                }
            });
            
            // Shuffle the words
            gameWords = gameWords.sort(() => Math.random() - 0.5);
            usedWords = [];
        }

        function setupGameControls() {
            const startGameBtn = document.getElementById('startGameBtn');
            const correctBtn = document.getElementById('correctWord');
            const skipBtn = document.getElementById('skipWord');
            const playAgainBtn = document.getElementById('playAgain');

            startGameBtn.addEventListener('click', startGame);
            correctBtn.addEventListener('click', () => handleWordResult('correct'));
            skipBtn.addEventListener('click', () => handleWordResult('skip'));
            playAgainBtn.addEventListener('click', resetGame);
        }

        function initializeGame() {
            updateCurrentPlayer();
            document.getElementById('currentWord').textContent = 'ğŸ®';
            document.getElementById('wordDifficulty').textContent = '';
            document.getElementById('gameControls').style.display = 'none';
            document.getElementById('startGameBtn').style.display = 'block';
        }

        function startGame() {
            gameActive = true;
            document.getElementById('startGameBtn').style.display = 'none';
            document.getElementById('gameControls').style.display = 'flex';
            
            startCurrentTeamTimer();
            showNextWord();
        }

        function startTimers() {
            timerIntervals.forEach(interval => clearInterval(interval));
            timerIntervals = [];
            startCurrentTeamTimer();
        }

        function startCurrentTeamTimer() {
            // Clear any existing timer
            timerIntervals.forEach(interval => clearInterval(interval));
            timerIntervals = [];

            const currentTeam = getCurrentTeam();
            const teamIndex = teams.findIndex(team => team === currentTeam);
            
            if (!currentTeam.eliminated) {
                const interval = setInterval(() => {
                    teamTimers[teamIndex] -= 100;
                    updateTimerBar(teamIndex);

                    if (teamTimers[teamIndex] <= 0) {
                        eliminateTeam(teamIndex);
                    }
                }, 100);
                timerIntervals.push(interval);
            }
        }

        function updateTimerBar(teamIndex) {
            const fill = document.getElementById(`timerFill${teamIndex}`);
            const percentage = (teamTimers[teamIndex] / teamTimeLimit) * 100;
            fill.style.width = `${Math.max(0, percentage)}%`;
        }

        function eliminateTeam(teamIndex) {
            teams[teamIndex].eliminated = true;
            clearInterval(timerIntervals[teamIndex]);
            
            const teamName = document.getElementById(`teamName${teamIndex}`);
            teamName.classList.add('eliminated');
            
            const activeteams = teams.filter(team => !team.eliminated);
            if (activeteams.length === 1) {
                endGame(activeteams[0]);
            } else if (activeteams.length === 0) {
                endGame(null);
            }
        }

        function showNextWord() {
            if (gameWords.length > 0 && usedWords.length < gameWords.length) {
                let wordObj;
                do {
                    wordObj = gameWords[Math.floor(Math.random() * gameWords.length)];
                } while (usedWords.some(used => used.word === wordObj.word));
                
                currentWord = wordObj.word;
                currentWordDifficulty = wordObj.difficulty;
                usedWords.push(wordObj);
                
                document.getElementById('currentWord').textContent = wordObj.word;
                
                // Show difficulty stars
                const difficultyText = 'â­'.repeat(wordObj.difficulty);
                document.getElementById('wordDifficulty').textContent = `Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ: ${difficultyText}`;
                
                // Disable skip button for specified time
                if (skipWaitTime > 0) {
                    const skipBtn = document.getElementById('skipWord');
                    skipBtn.disabled = true;
                    skipBtn.textContent = `Ø±Ø¯ Ú©Ø±Ø¯Ù† (${skipWaitTime})`;
                    
                    let countdown = skipWaitTime;
                    skipCountdownInterval = setInterval(() => {
                        countdown--;
                        if (countdown > 0) {
                            skipBtn.textContent = `Ø±Ø¯ Ú©Ø±Ø¯Ù† (${countdown})`;
                        } else {
                            skipBtn.disabled = false;
                            skipBtn.textContent = 'Ø±Ø¯ Ú©Ø±Ø¯Ù† â¯';
                            clearInterval(skipCountdownInterval);
                            skipCountdownInterval = null;
                        }
                    }, 1000);
                }
                
            } else {
                // Reset used words if we've used them all
                usedWords = [];
                showNextWord();
            }
        }

        function handleWordResult(action) {
            if (!gameActive) return;
            if (skipCountdownInterval) {
                clearInterval(skipCountdownInterval);
                skipCountdownInterval = null;
            }
            if (action === 'correct') {
                // Got it: change team and show next word
                nextPlayer();
                showNextWord();
            } else if (action === 'skip') {
                // Skip: just show next word, same team
                showNextWord();
            }
        }

        function getCurrentTeam() {
            // Find which team the current player belongs to
            for (let i = 0; i < teams.length; i++) {
                if (teams[i].players.some(player => player.id === currentPlayerIndex)) {
                    return teams[i];
                }
            }
            return teams[0]; // fallback
        }

        function nextPlayer() {
            // Stop current team's timer
            timerIntervals.forEach(interval => clearInterval(interval));
            timerIntervals = [];
            
            // Move to next explainer in circular order, skipping eliminated teams
            do {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            } while (getCurrentTeam().eliminated);
            
            updateCurrentPlayer();
            
            // Start the new team's timer
            startCurrentTeamTimer();
        }

        function updateCurrentPlayer() {
            const currentPlayer = players[currentPlayerIndex];
            const currentTeam = getCurrentTeam();
            
            // Find the teammate (the other player in the same team)
            const teammate = currentTeam.players.find(player => player.id !== currentPlayerIndex);
            
            // Update game area border color to match current team
            const gameArea = document.querySelector('.game-area');
            gameArea.style.borderColor = currentTeam.color;
            
            document.getElementById('currentPlayer').innerHTML = 
                `<span style="color: ${currentTeam.color}; font-weight: bold;">${currentPlayer.name}`;
        }

        function endGame(winningTeam) {
            gameActive = false;
            timerIntervals.forEach(interval => clearInterval(interval));
            
            const winnerText = document.getElementById('winnerText');
            if (winningTeam) {
                const playerNames = winningTeam.players.map(p => p.name).join(' Ùˆ ');
                winnerText.innerHTML = `ğŸ† <span style="color: ${winningTeam.color};">ØªÛŒÙ… ${winningTeam.id + 1} (${winningTeam.colorName})</span> Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯! ğŸ†<br><small>${playerNames}</small>`;
            } else {
                winnerText.textContent = 'â° ÙˆÙ‚Øª ØªÙ…Ø§Ù… Ø´Ø¯! Ø¨Ø§Ø²Ù†Ø¯Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³Øª!';
            }
            
            showScreen('winner');
        }

        function resetGame() {
            // Don't reset selectedCategories and savedPlayerNames - keep them for next game
            players = [];
            teams = [];
            currentPlayerIndex = 0;
            gameActive = false;
            teamTimers = [];
            timerIntervals.forEach(interval => clearInterval(interval));
            timerIntervals = [];
            
            // Restore previously selected categories
            selectedCategories = [...savedCategories];
            
            // Re-select the category buttons
            document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('selected');
                if (savedCategories.includes(cat.dataset.category)) {
                    cat.classList.add('selected');
                }
            });
            
            // Enable next button if categories were selected
            const nextBtn = document.getElementById('nextToPlayers');
            nextBtn.disabled = savedCategories.length === 0;
            
            showScreen('category');
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens[screenName].classList.add('active');
        }

        // Initialize the game when page loads
        init();
    </script>
</body>
</html>
